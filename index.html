<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photobox Kemerdekaan Indonesia ke-80 | RT 004/RW 008</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@700&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f8f8f8;
            overflow-x: hidden;
        }
        
        .title-font {
            font-family: 'Poppins', sans-serif;
        }
        
        .flag-animation {
            animation: wave 3s ease-in-out infinite alternate;
        }
        
        @keyframes wave {
            0% { transform: rotate(-2deg); }
            100% { transform: rotate(2deg); }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
        
        .garuda {
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.7));
        }
        
        .photo-frame {
            box-shadow: 0 0 0 10px #fff, 0 0 0 15px #c00, 0 0 0 25px #fff, 0 0 0 30px #c00;
        }
        
        .countdown {
            font-size: 10rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        #videoElement {
            transform: scaleX(-1); /* Mirror effect */
        }
        
        .hero-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c00' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
    </style>
</head>
<body class="hero-pattern min-h-screen flex flex-col items-center justify-center p-4">
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
        <!-- Background elements -->
        <div class="absolute top-10 left-10 flag-animation">
            <svg width="80" height="60" viewBox="0 0 80 60">
                <rect width="80" height="30" fill="#c00"/>
                <rect y="30" width="80" height="30" fill="#fff"/>
            </svg>
        </div>
        <div class="absolute top-20 right-20 flag-animation" style="animation-delay: 0.5s;">
            <svg width="60" height="40" viewBox="0 0 60 40">
                <rect width="60" height="20" fill="#c00"/>
                <rect y="20" width="60" height="20" fill="#fff"/>
            </svg>
        </div>
        <div class="absolute bottom-10 right-10 flag-animation" style="animation-delay: 1s;">
            <svg width="100" height="70" viewBox="0 0 100 70">
                <rect width="100" height="35" fill="#c00"/>
                <rect y="35" width="100" height="35" fill="#fff"/>
            </svg>
        </div>
        
        <!-- Garuda -->
        <div class="absolute top-1/4 left-1/4 garuda opacity-20 transform -rotate-12">
            <svg width="120" height="120" viewBox="0 0 512 512">
                <!-- Simplified Garuda Pancasila -->
                <path fill="#FFD700" d="M256,0c141.4,0,256,114.6,256,256S397.4,512,256,512S0,397.4,0,256S114.6,0,256,0z"/>
                <path fill="#8B0000" d="M256,40c119.3,0,216,96.7,216,216S375.3,472,256,472S40,375.3,40,256S136.7,40,256,40z"/>
                <path fill="#FFD700" d="M256,80c97.2,0,176,78.8,176,176s-78.8,176-176,176S80,353.2,80,256S158.8,80,256,80z"/>
                <path fill="#8B0000" d="M256,120c75.1,0,136,60.9,136,136s-60.9,136-136,136S120,331.1,120,256S180.9,120,256,120z"/>
            </svg>
        </div>
        
        <!-- Number 80 -->
        <div class="absolute top-1/2 right-1/4 transform translate-x-1/2 -translate-y-1/2 opacity-10">
            <span class="text-9xl font-bold text-red-600">80</span>
        </div>
    </div>

    <main class="relative z-10 w-full max-w-4xl flex flex-col items-center">
        <h1 class="title-font text-4xl md:text-5xl font-bold text-center mb-8 text-red-700">
            PHOTOBOX KEMERDEKAAN
        </h1>
        
        <div id="photoContainer" class="relative w-full max-w-lg mb-8">
            <!-- Webcam view -->
            <div id="cameraView" class="relative overflow-hidden rounded-lg bg-gray-200 aspect-[3/4] flex items-center justify-center">
                <video id="videoElement" autoplay playsinline class="hidden w-full h-full object-cover"></video>
                <canvas id="canvasElement" class="hidden w-full h-full object-cover"></canvas>
                
                <!-- Placeholder before camera starts -->
                <div id="placeholder" class="w-full h-full flex flex-col items-center justify-center bg-gradient-to-b from-red-50 to-white p-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <p class="text-center text-gray-700">Kamera siap untuk mengambil foto peringatan Kemerdekaan Indonesia ke-80</p>
                </div>
                
                <!-- Countdown overlay -->
                <div id="countdownOverlay" class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                    <span id="countdownText" class="countdown text-white">3</span>
                </div>
            </div>
            
            <!-- Photo frame decoration -->
            <div id="frameDecoration" class="photo-frame absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-300"></div>
            
            <!-- Photo overlay elements -->
            <div id="photoOverlay" class="absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-300">
                <!-- Top decoration -->
                <div class="absolute top-0 left-0 right-0 flex justify-center pt-4">
                    <div class="bg-red-600 text-white px-6 py-2 rounded-full shadow-lg">
                        <h2 class="title-font text-xl md:text-2xl font-bold">DIRGAHAYU REPUBLIK INDONESIA</h2>
                    </div>
                </div>
                
                <!-- Bottom text -->
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent pb-4 pt-8 px-4 text-center">
                    <p class="text-white text-xl md:text-2xl font-bold">KE-80</p>
                    <p class="text-white text-lg">RT 004 / RW 008</p>
                </div>
                
                <!-- Flag elements -->
                <div class="absolute top-1/4 left-4 flag-animation">
                    <svg width="60" height="40" viewBox="0 0 60 40">
                        <rect width="60" height="20" fill="#c00"/>
                        <rect y="20" width="60" height="20" fill="#fff"/>
                    </svg>
                </div>
                
                <div class="absolute top-1/3 right-4 flag-animation" style="animation-delay: 0.3s;">
                    <svg width="50" height="30" viewBox="0 0 50 30">
                        <rect width="50" height="15" fill="#c00"/>
                        <rect y="15" width="50" height="15" fill="#fff"/>
                    </svg>
                </div>
                
                <!-- Confetti elements (will be added dynamically) -->
            </div>
        </div>
        
        <!-- Controls -->
        <div class="flex flex-col sm:flex-row gap-4 w-full max-w-lg">
            <button id="startButton" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-6 rounded-lg shadow-md transition-all duration-300 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                MULAI FOTO
            </button>
            
            <button id="downloadButton" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-4 px-6 rounded-lg shadow-md transition-all duration-300 flex items-center justify-center gap-2 opacity-0 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                UNDUH FOTO
            </button>
        </div>
    </main>
    
    <footer class="mt-12 text-center text-gray-600 text-sm">
        <p>© 2024 Photobox Kemerdekaan Indonesia ke-80 | RT 004/RW 008</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const videoElement = document.getElementById('videoElement');
            const canvasElement = document.getElementById('canvasElement');
            const startButton = document.getElementById('startButton');
            const downloadButton = document.getElementById('downloadButton');
            const placeholder = document.getElementById('placeholder');
            const countdownOverlay = document.getElementById('countdownOverlay');
            const countdownText = document.getElementById('countdownText');
            const photoOverlay = document.getElementById('photoOverlay');
            const frameDecoration = document.getElementById('frameDecoration');
            let stream = null;
            
            // Initialize camera
            async function initCamera() {
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                    videoElement.srcObject = stream;
                    videoElement.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                } catch (err) {
                    console.error("Error accessing camera: ", err);
                    placeholder.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <p class="text-center text-gray-700">Akses kamera ditolak. Mohon izinkan akses kamera untuk menggunakan photobox ini.</p>
                    `;
                }
            }
            
            // Start countdown and take photo
            function startCountdown() {
                let count = 3;
                countdownOverlay.classList.remove('hidden');
                countdownText.textContent = count;
                
                const timer = setInterval(() => {
                    count--;
                    countdownText.textContent = count;
                    
                    if (count <= 0) {
                        clearInterval(timer);
                        countdownOverlay.classList.add('hidden');
                        takePhoto();
                    }
                }, 1000);
            }
            
            // Take photo from webcam
            function takePhoto() {
                const context = canvasElement.getContext('2d');
                canvasElement.width = videoElement.videoWidth;
                canvasElement.height = videoElement.videoHeight;
                
                // Draw the current frame from the video on the canvas
                context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
                
                // Hide video and show canvas
                videoElement.classList.add('hidden');
                canvasElement.classList.remove('hidden');
                
                // Show photo overlay and frame
                photoOverlay.classList.remove('opacity-0');
                frameDecoration.classList.remove('opacity-0');
                
                // Enable download button
                downloadButton.classList.remove('opacity-0', 'pointer-events-none');
                
                // Create confetti effect
                createConfetti();
            }
            
            // Create confetti animation
            function createConfetti() {
                const colors = ['#c00', '#fff', '#ff0'];
                const container = photoOverlay;
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = -10 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    
                    container.appendChild(confetti);
                    
                    const animationDuration = Math.random() * 3 + 2;
                    
                    confetti.animate([
                        { opacity: 0, transform: 'translateY(0) rotate(0deg)' },
                        { opacity: 1, transform: `translateY(${Math.random() * 100 + 100}px) rotate(${Math.random() * 360}deg)` }
                    ], {
                        duration: animationDuration * 1000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.3, 1)',
                        fill: 'forwards'
                    });
                }
            }
            
            // Download photo
            function downloadPhoto() {
                // Use html2canvas to capture the entire photo container with decorations
                html2canvas(document.getElementById('photoContainer'), {
                    backgroundColor: null,
                    scale: 2 // Higher quality
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'Foto-Kemerdekaan-RT004-RW008-' + new Date().toISOString().slice(0, 10) + '.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }
            
            // Event listeners
            startButton.addEventListener('click', startCountdown);
            downloadButton.addEventListener('click', downloadPhoto);
            
            // Initialize camera when page loads
            initCamera();
        });
    </script>
</body>
</html>
